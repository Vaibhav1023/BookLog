{"ast":null,"code":"/**\n * api.js — the only file that makes HTTP requests.\n *\n * Reads the JWT from localStorage and injects it into every\n * authenticated request. Components never handle tokens directly.\n */\n\nconst BASE = \"http://localhost:5000/api\";\nasync function request(path, options = {}, auth = true) {\n  const headers = {\n    \"Content-Type\": \"application/json\"\n  };\n  if (auth) {\n    const token = localStorage.getItem(\"token\");\n    if (token) headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  try {\n    const res = await fetch(`${BASE}${path}`, {\n      ...options,\n      headers\n    });\n    if (res.status === 204) return {\n      data: null,\n      error: null\n    };\n    const body = await res.json();\n    if (!res.ok) {\n      const message = body.errors ? body.errors.join(\" • \") : body.error || `HTTP ${res.status}`;\n      return {\n        data: null,\n        error: message\n      };\n    }\n    return {\n      data: body,\n      error: null\n    };\n  } catch {\n    return {\n      data: null,\n      error: \"Cannot reach server. Is the backend running?\"\n    };\n  }\n}\nexport const authApi = {\n  register: data => request(\"/auth/register\", {\n    method: \"POST\",\n    body: JSON.stringify(data)\n  }, false),\n  login: data => request(\"/auth/login\", {\n    method: \"POST\",\n    body: JSON.stringify(data)\n  }, false),\n  me: () => request(\"/auth/me\")\n};\nexport const bookApi = {\n  list: (params = {}) => {\n    const qs = new URLSearchParams(Object.fromEntries(Object.entries(params).filter(([, v]) => v))).toString();\n    return request(`/books${qs ? `?${qs}` : \"\"}`);\n  },\n  get: id => request(`/books/${id}`),\n  stats: () => request(\"/books/stats\"),\n  create: data => request(\"/books\", {\n    method: \"POST\",\n    body: JSON.stringify(data)\n  }),\n  update: (id, data) => request(`/books/${id}`, {\n    method: \"PATCH\",\n    body: JSON.stringify(data)\n  }),\n  delete: id => request(`/books/${id}`, {\n    method: \"DELETE\"\n  })\n};\nexport const searchApi = {\n  search: q => request(`/search?q=${encodeURIComponent(q)}`)\n};","map":{"version":3,"names":["BASE","request","path","options","auth","headers","token","localStorage","getItem","res","fetch","status","data","error","body","json","ok","message","errors","join","authApi","register","method","JSON","stringify","login","me","bookApi","list","params","qs","URLSearchParams","Object","fromEntries","entries","filter","v","toString","get","id","stats","create","update","delete","searchApi","search","q","encodeURIComponent"],"sources":["C:/Users/chvai/Downloads/booklog/booklog/frontend/src/services/api.js"],"sourcesContent":["/**\n * api.js — the only file that makes HTTP requests.\n *\n * Reads the JWT from localStorage and injects it into every\n * authenticated request. Components never handle tokens directly.\n */\n\nconst BASE = \"http://localhost:5000/api\";\n\nasync function request(path, options = {}, auth = true) {\n  const headers = { \"Content-Type\": \"application/json\" };\n  if (auth) {\n    const token = localStorage.getItem(\"token\");\n    if (token) headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n\n  try {\n    const res = await fetch(`${BASE}${path}`, { ...options, headers });\n    if (res.status === 204) return { data: null, error: null };\n\n    const body = await res.json();\n    if (!res.ok) {\n      const message = body.errors ? body.errors.join(\" • \") : body.error || `HTTP ${res.status}`;\n      return { data: null, error: message };\n    }\n    return { data: body, error: null };\n  } catch {\n    return { data: null, error: \"Cannot reach server. Is the backend running?\" };\n  }\n}\n\nexport const authApi = {\n  register: (data) => request(\"/auth/register\", { method: \"POST\", body: JSON.stringify(data) }, false),\n  login: (data) => request(\"/auth/login\", { method: \"POST\", body: JSON.stringify(data) }, false),\n  me: () => request(\"/auth/me\"),\n};\n\nexport const bookApi = {\n  list: (params = {}) => {\n    const qs = new URLSearchParams(Object.fromEntries(Object.entries(params).filter(([, v]) => v))).toString();\n    return request(`/books${qs ? `?${qs}` : \"\"}`);\n  },\n  get: (id) => request(`/books/${id}`),\n  stats: () => request(\"/books/stats\"),\n  create: (data) => request(\"/books\", { method: \"POST\", body: JSON.stringify(data) }),\n  update: (id, data) => request(`/books/${id}`, { method: \"PATCH\", body: JSON.stringify(data) }),\n  delete: (id) => request(`/books/${id}`, { method: \"DELETE\" }),\n};\n\nexport const searchApi = {\n  search: (q) => request(`/search?q=${encodeURIComponent(q)}`),\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}